<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>메인 페이지</title>
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
     <style> 

        body 
        {
             margin: 0; /* Remove default margin from body */
              overflow-x: scroll; /* 가로 스크롤 유지 */
               overflow-y: hidden; 
            } 

        .class-container {
            display: flex;
            height: 100vh;
            width: 8200px; /* 클래스 컨테이너의 가로 크기를 지정 */
            background-color: rgba(203, 203, 203, 0.39);
        }

        .class {
            padding-top: 20px;
            text-align: center;
            margin-bottom: 20px;
            height: 100%;
            position: relative;
            white-space: nowrap;
            width: 290px; /* 클래스의 가로 크기를 지정 */
        }

    /* /////////////////위에 CSS는 거의 건들일X/////////////////// */

		/*환영합니다 ! 님*/
		.welcome_user_p
		{
		  font-weight:bold;
		  height: 40px;
		  position: absolute;
		  padding-top: 20px;
		  padding-left: 20px;
		}


    /* 하단밑 클래스 추가하는 버튼 */
        #addClassButton {
            position: fixed;
            right: 20px;
            bottom: 20px;
            font-size: 20px;
            width: 36px;
            height: 36px;
            border-radius: 100%;
            color: white;
            background-color:  #D99D81;
            border: none;
            outline: none;
            cursor: pointer;
            box-shadow: 2px 2px 10px 0px rgba(0, 0, 0, 0.114);
        }

    

        /* 클래스(타이틀) 이름 박스 */
        .title_div {
            box-shadow: 2px 2px 10px 0px rgba(0, 0, 0, 0.114);
            border-radius: 20px  35px 20px  35px;
            width: 265px;
            background-color:#dfbaa4;
            margin-top: 60px;
        }

        /* 클래스(타이틀) 글씨*/
        .title_h6 {
            font-size: 16px;
            font-weight: bold;
            padding-top: 20px;
            padding-bottom: 20px;
        }

        /* + 포스트 추가 버튼- 직사각형 표시  */
        .addPost {
            width: 250px;
            font-size: 15px;
            color: rgb(119, 119, 119);
            font-weight: bold;
            background-color: #f4e1d1;
            box-shadow: 2px 2px 10px 0px rgba(0, 0, 0, 0.114);
            border: none;
            outline: none;
            cursor: pointer;
            margin-top: 10px;
            padding-top: 4px;
            padding-bottom: 4px;
        }

        /* 클래스 이름의 x 표시 - 제거용  */
        .removeClass {
            position: absolute;
            top: 95px;
            right: 30px;
            font-weight: bold;
            background-color:#dfbaa4;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        /* 게시물 다 담는 (한클래스에 대한 )(길죽한) 콘테이너 */
        .post-container {
            margin-top: 20px;
            padding-top: 10px;
            width: 100%;
            overflow-y: auto;
            height: 80%;
        }
        /* 게시물 제목  */
        .content_title_h5 {
            font-size: 14px;
            font-weight: bold;
            height: 50px;
            padding-left: 7px;
            padding-right: 7px;
            overflow: hidden;
        }

        /* 게시물 하나 박스  */
        .post {
            margin-bottom: 10px;
            background-color: rgb(249, 249, 249);
            cursor: pointer;
            padding: 10px;
            margin-left: -3px;
            box-shadow: 2px 2px 4px 0px rgba(0,0,0,0.2);
            width: 99%;
            border-radius: 24px;   
            /* 줄바꿈 실행 */
            white-space: normal;
            word-wrap: break-word;
        }
        /* 포스트 이미지 */
        .post_img
        {
            height: 100px;
        }

    /* POST 작성글의 내용물 */
        .content_p {
            font-size: 13px;
        }

        /* 스크롤 배경 */
        .post-container::-webkit-scrollbar {
            width: 8px; /* Set the width of the scrollbar */
            margin-left: 2px;
            border-radius: 100px;
            background-color: #d99d812b;


        }

          /*  내용물과 댓글 구별선 */
          .hr_border
        {
            border: 0.7px solid #000; /* 두께: 2px, 실선 스타일, 검은색 선 */
        }
    

        /* 스크롤 바 */
        .post-container::-webkit-scrollbar-thumb {
            background-color: #d99d81c2;
            border-radius: 50px; /* Set the border radius of the thumb */
        }

        /* POST 글에 좋아요 버튼 */
        .like-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            margin-left: 2px;
            height: 24px;
            background-color: #fff;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            outline: none;
            font-size: 13px;
        }

        .like-button:hover {
            background-color: #f0f0f0;
        }

        .like-button:active {
            background-color: #000000;
            color: white;
        }

        .like-icon {
            width: 16px;
            height: 16px;
            fill: #c17244;
            margin-right: 3px;
        }

        /*  댓글  */
        .comment-container {
            margin-top: 10px;
            border-radius: 28px;
        }

        .comment-form {
            display: flex;
            white-space: normal;
            word-wrap: break-word;
            margin-bottom: 10px;
            height: 25px;
        }
        /* 댓글 작성폼 */
        .comment-input {
            flex: 1;
            margin-right: 10px;
            padding: 5px;
            border-radius: 24px;
            width: 80px;
            outline: none;
            font-size: 12px;
            border: none;
        }
        /* 댓글 등록 버튼 */
        .comment-submit {
            background-color:#D59F82;
            color: #fff;
            border: none;
            border-radius: 24px;
            font-size: 10px;
            cursor: pointer;
            outline: none;
            height: 25px;
        }
        /* 댓글 하나하나 */
        .comment {
            cursor: default;
            margin-bottom: 25px;
            border-radius: 8px; /* Optional: Add border-radius for rounded corners */
        }

        /* 댓글 유저정보와 : 표시 담은 박스 */
        .comment-usercontent {
            margin-bottom: -20px;
            cursor:pointer;
            display: flex; /* Flexbox를 사용하여 자식 요소를 옆으로 나열 */
            align-items: center; /* 세로 중앙 정렬 */
        }

        /*  댓글 작성자 */
        .comment-username {
            font-weight: bold;
            font-size: 8.5px;
            margin-top: -2px;
        
         }
         /* 댓글 : 버튼 */
        .comment-dot {
            display: block;
            border: none;
            margin-left: 165px; /* 조절 가능한 마진 값 */
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            background-color: rgb(249, 249, 249);
            outline: none;
        }

        /* 댓글 내용물 */
        .comment-content {
            text-align: left;
            padding-left: 3px;
            margin-left: 1px;
            margin-top: -10px;
            font-size: 13px;
            cursor: default;
            margin-bottom: 5px; /* 추가된 부분: 댓글 컨텐츠와 다음 hr 간격을 조정 */
         }

       

        .comment-usercontent hr {
            border: none; /* Remove the default border */
            margin-top: -2px;
            margin-bottom: 5px; /* 수정된 부분: hr 간격을 조정 */
            border-top: 1px solid #000; /* Add your preferred border style */
        
        }

        .comment-menu {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            padding: 12px 16px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1;
            cursor: pointer;
        }
</style>

</head>
<body>
<<<<<<< HEAD
	
	
	 <div class="container-fluid class-container">
	 <p id="welcomeUser" class="welcome_user_p" th:text="'환영합니다.' + ${userName} + '님'"></p>
	 <br>
         <div class="row"> 
            <!-- Classes will be dynamically added here --> 
        </div>
      </div>
	  <button id="addClassButton">+</button>
	
	
<script>
function addCommentMenu(commentDotElement, postId, commentIndex, commentElement) {
    var commentMenu = document.createElement('div');
    commentMenu.className = 'comment-menu';
    commentMenu.id = `comment-menu-${postId}-${commentIndex}`;
    commentMenu.innerHTML = `
        <p class="editComment">댓글 수정</p>
        <p class="deleteComment">댓글 삭제</p>
    `;
    commentDotElement.appendChild(commentMenu);

    commentDotElement.addEventListener('click', function() {
        if(commentMenu.style.display === "none") {
            commentMenu.style.display = "block";
        } else {
            commentMenu.style.display = "none";
        }
    });

    // 댓글 수정 기능
    commentMenu.querySelector(".editComment").addEventListener("click", function() {
        var commentContent = prompt("수정할 댓글을 입력하세요:");
        if (commentContent) {
            fetch(`http://localhost:8080/api/comments/${commentIndex}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    content: commentContent
                })
            }).then(response => {
                if (response.ok) {
                    commentElement.querySelector(".comment-content").textContent = commentContent;
                }
            });
            commentMenu.style.display = "none";
        }
    });

    // 댓글 삭제 기능
    commentMenu.querySelector(".deleteComment").addEventListener("click", function() {
        var confirmDelete = confirm("댓글을 삭제하시겠습니까?");
        if (confirmDelete) {
            fetch(`http://localhost:8080/api/comments/${commentIndex}`, {
                method: 'DELETE'
            }).then(response => {
                if (response.ok) {
                    commentElement.parentNode.removeChild(commentElement);
                }
            });
            commentMenu.style.display = "none";
        }
    });
}

//댓글 추가 기능 구현
function addComment(postId, commentContent) {
  fetch('http://localhost:8080/api/comments', {  // 서버 주소
      method: 'POST', // 요청 메소드
      headers: {
          'Content-Type': 'application/json'
      },
      body: JSON.stringify({  // 요청 본문
          postId: postId,
          content: commentContent
      })
  })
  .then(response => {
      if (!response.ok) {
          throw new Error('Network response was not ok');
      }
      return response.json();
  })
  .then(data => {
      console.log('Success:', data);
  })
  .catch((error) => {
      console.error('Error:', error);
  });
}

// 댓글 수정 기능 구현
function editComment(postId, commentIndex, newContent, commentElement) {
    var posts = JSON.parse(localStorage.getItem("posts")) || {};
    var post = posts[postId];

    if (post && post.comments && post.comments.length > commentIndex) {
        post.comments[commentIndex] = newContent;
        localStorage.setItem("posts", JSON.stringify(posts));

        var commentContent = commentElement.querySelector(".comment-content");
        commentContent.textContent = newContent;
    }
}

// 댓글 삭제 기능 구현
function removeComment(postId, commentIndex) {
    var posts = JSON.parse(localStorage.getItem("posts")) || {};
    var post = posts[postId];

    if (post && post.comments && post.comments.length > commentIndex) {
        post.comments.splice(commentIndex, 1);
        localStorage.setItem("posts", JSON.stringify(posts));

        var commentContainer = document.getElementById("comments" + postId);
        var commentElement = commentContainer.getElementsByClassName("comment")[commentIndex];
        commentContainer.removeChild(commentElement);
    }
}

//클래스를 삭제하는 기능 구현
function removeClass(classEntityId) {
 fetch(`http://localhost:8080/api/classes/${classEntityId}`, {
     method: 'DELETE'
 })
 .then(response => {
     if (!response.ok) {
         throw new Error('Network response was not ok');
     }
     location.reload();  // 클래스 삭제 후 페이지를 새로 고침합니다.
 })
 .catch((error) => {
     console.error('Error:', error);
 });
}

//좋아요 추가 기능 구현
function addLike(postId) {
    fetch(`http://localhost:8080/api/posts/${postId}/likes`, {
        method: 'POST'
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        console.log('Success:', data);
        location.reload();  // 좋아요 추가 후 페이지를 새로 고침합니다.
    })
    .catch((error) => {
        console.error('Error:', error);
    });
}

//좋아요 삭제 기능 구현
function removeLike(postId) {
 fetch(`http://localhost:8080/api/posts/${postId}/likes`, {
     method: 'DELETE'
 })
 .then(response => {
     if (!response.ok) {
         throw new Error('Network response was not ok');
     }
     return response.json();
 })
 .then(data => {
     console.log('Success:', data);
     location.reload();  // 좋아요 삭제 후 페이지를 새로 고침합니다.
 })
 .catch((error) => {
     console.error('Error:', error);
 });
}


function addClass() {
    var className = prompt("클래스 이름을 입력하세요 (10글자 제한):");
    if (className) {
        className = className.slice(0, 10);

        fetch('http://localhost:8080/api/classes', {  
            method: 'POST', 
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({  
                name: className
            })
        })
        .then(response => response.json())
        .then(data => {
            // 클래스를 성공적으로 추가했다면, 페이지를 새로 고침합니다.
            location.reload();
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    }
}


document.addEventListener("DOMContentLoaded", function () {
    fetch('http://localhost:8080/api/classes', {  
        method: 'GET',
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(classes => {
        classes.forEach(function (classEntity) {
            var classDiv = document.createElement("div");

            classDiv.className = "class col";
            classDiv.id = classEntity.id;
            classDiv.innerHTML = `
            <div class="title_div"><h6 class="title_h6">${classEntity.name}</h6></div>
                <button class="addPost">+</button>
                <button class="removeClass" onclick="removeClass('${classEntity.id}')">x</button>
                <div class="post-container" id="posts${classEntity.id}">
                </div>`;
            document.querySelector(".row").appendChild(classDiv);

            var addPostButton = classDiv.querySelector(".addPost"); 
            
            // post 추가 버튼 클릭 이벤트 리스너 추가
            addPostButton.addEventListener("click", function () {
                var formUrl = "form.html?classId=" + classEntity.id;
                window.location.href = formUrl;
            });
            
            fetch(`http://localhost:8080/api/classes/${classEntity.id}/posts`, {  
                method: 'GET',
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(posts => {
                posts.forEach(function (post, index) {
                    var postElement = document.createElement("div");
                    postElement.className = "post";
                    postElement.id = classEntity.id + "-post-" + index;

                    // 게시글을 화면에 추가합니다.
                    postElement.innerHTML = `<h5 class="content_title_h5">${post.title}</h5>
                    <img src="f.png" alt="Image F" class="post_img">     
                    <p class="content_p">${post.content}</p>
                    <hr class="hr_border">
                    <div class="comment-container">
                        <form id="commentForm${classEntity.id}-post-${index}" class="comment-form">
                            <input type="text" class="comment-input" placeholder="댓글을 입력하세요">
                            <button type="button" class="comment-submit" onclick="addComment('${classEntity.id}-post-${index}')">등록</button>
                        </form>
                        <div id="comments${classEntity.id}-post-${index}" class="comments">
                            <!-- 댓글이 동적으로 추가될 공간 -->
                        </div>
                    </div>
                    <div class="like-button" onclick="addLike('${classEntity.id}-post-${index}')">
                        <svg class="like-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 21.35l-1.45-1.32C6.34 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C16.09 3.81 17.76 3 19.5 3 22.58 3 25 5.42 25 8.5c0 3.78-4.34 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                    	 <span class="like-count">${post.likes || 0}</span>`;
                    var postContainer = document.getElementById("posts" + classEntity.id);
                    postContainer.appendChild(postElement);

                    // 댓글 추가 버튼에 이벤트 리스너를 추가합니다.
                    var commentForm = postElement.querySelector(".comment-form");
                    commentForm.addEventListener("submit", function (event) {
                        event.preventDefault();
                        var commentInput = this.querySelector(".comment-input");
                        var comment = commentInput.value;
                        commentInput.value = "";
                        
                        // 서버에 댓글을 추가하는 요청을 보냅니다.
                        fetch(`http://localhost:8080/api/posts/${post.id}/comments`, {  
                            method: 'POST', 
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({  
                                comment: comment
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                            // 댓글을 성공적으로 추가했다면, 페이지를 새로 고침합니다.
                            location.reload();
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                    });
                });
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        
      
            // 클래스 추가 버튼에 대한 이벤트 리스너를 한 번만 등록합니다.
    		var addClassButton = document.getElementById("addClassButton");
    		 addClassButton.addEventListener("click", addClass);

            
        });
    })
    .catch((error) => {
        console.error('Error:', error);
    });
});

</script>

	

	<p th:text="'환영합니다.' + ${userName} + '님'"></p>
	<div>
    	<button type="button" onclick="window.location.href='/logout'">로그아웃</button>
    </div>

</body>
</html>

