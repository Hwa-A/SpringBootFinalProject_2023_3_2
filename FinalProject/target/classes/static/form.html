<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>글 작성 폼</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <style>
        body {
            padding: 20px;
        }
        form {
            max-width: 300px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <h2>글 작성 폼</h2>
    <form id="postForm" enctype="multipart/form-data">
        <div class="form-group">
            <label for="postTitle">글 제목</label>
            <input type="text" class="form-control" id="postTitle" name="postTitle" required>
        </div>
        <div class="form-group">
            <label for="postContent">글 내용</label>
            <textarea class="form-control" id="postContent" name="postContent" rows="3" required></textarea>
        </div>
        
        <button type="submit" class="btn btn-primary">추가</button>
    </form>

   <script>
   document.getElementById("postForm").addEventListener("submit", function (event) {
	    event.preventDefault();
	    var urlParams = new URLSearchParams(window.location.search);
	    var classId = urlParams.get("classId");  // 변경된 부분

	    // Logging for debugging
	    console.log("classId:", classId);

	    if (!classId) {
	        console.error("classId is null");
	        // You can choose to return, display an error message, or set a default value.
	        return;
	    }

	    var postTitle = document.getElementById("postTitle").value;
	    var postContent = document.getElementById("postContent").value;

	    var formData = new FormData();
        formData.append("classId", classId);
        formData.append("title", postTitle);
        formData.append("content", postContent);

        fetch('http://localhost:8080/api/posts?classId=' + classId, {
            method: 'POST',
            body: formData
            // 참고: Content-Type 헤더는 'multipart/form-data'로 자동 설정됩니다.
        })
        .then(response => {
            console.log('Response Status:', response.status);
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log('Success:', data);
            window.location.href = "home";
        })
        .catch((error) => {
            console.error('Error:', error);
        });
    });
</script>
</body>
</html>
